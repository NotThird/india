---
/**
 * Bookings Page (bookings.astro)
 *
 * Purpose: Display all travel bookings including flights, visa, and accommodation.
 *
 * Sections:
 * - Flights: Emirates confirmation and all 4 flight segments
 * - Visa: ETA details and status
 * - Accommodation: Hotel information
 *
 * Data Sources:
 * - flights.json: Flight booking details
 * - travelers.json: Visa information
 * - accommodation.json: Hotel details
 */

import BaseLayout from "../layouts/BaseLayout.astro";
import Card from "../components/Card.astro";
import Badge from "../components/Badge.astro";
import FlightCard from "../components/FlightCard.astro";

import flightsData from "../data/flights.json";
import travelersData from "../data/travelers.json";
import accommodationData from "../data/accommodation.json";

import type { FlightsData, TravelersData, AccommodationData, FlightSegment } from "../types/data";

// Type assertions
const flights = flightsData as FlightsData;
const travelers = travelersData as TravelersData;
const accommodations = accommodationData as AccommodationData;

// Get the primary traveler's visa info
const traveler = travelers.travelers[0];
const visa = traveler.visa;

// Get the primary accommodation
const hotel = accommodations.accommodations[0];

// Group flights by direction
const outboundFlights = flights.segments.filter((s: FlightSegment) => s.direction === "outbound");
const returnFlights = flights.segments.filter((s: FlightSegment) => s.direction === "return");

// Format date for display
function formatDate(dateStr: string): string {
  const date = new Date(dateStr);
  return date.toLocaleDateString("en-US", {
    month: "long",
    day: "numeric",
    year: "numeric",
  });
}

// Get badge variant for accommodation status
function getAccommodationStatusVariant(status: string): "confirmed" | "considering" | "tbc" {
  switch (status) {
    case "confirmed":
      return "confirmed";
    case "considering":
      return "considering";
    default:
      return "tbc";
  }
}

// Get display text for accommodation status
function getAccommodationStatusText(status: string): string {
  switch (status) {
    case "confirmed":
      return "Confirmed";
    case "considering":
      return "Under Consideration";
    case "cancelled":
      return "Cancelled";
    default:
      return status;
  }
}
---

<BaseLayout title="Bookings" description="Flight confirmations, visa details, and accommodation for Chennai Wedding Trip 2026">
  <!-- Page Header -->
  <header class="page-header">
    <h1 class="page-title">Bookings</h1>
    <p class="page-description">
      All your travel arrangements in one place: flights, visa, and accommodation.
    </p>
  </header>

  <!-- Flights Section -->
  <section class="section">
    <div class="section-header">
      <h2 class="section-title">
        <span class="section-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17.8 19.2L16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z"></path>
          </svg>
        </span>
        Flights
      </h2>
    </div>

    <!-- Confirmation Code -->
    <Card class="confirmation-card">
      <div class="confirmation-content">
        <div class="confirmation-info">
          <span class="confirmation-label">Emirates Confirmation Code</span>
          <span class="confirmation-code">{flights.confirmationCode}</span>
        </div>
        <div class="airline-logo">
          <span class="airline-name">{flights.airline}</span>
        </div>
      </div>
    </Card>

    <!-- Outbound Flights -->
    <div class="flight-group">
      <h3 class="flight-group-title">
        <span class="group-icon outbound">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </span>
        Outbound: Dallas to Chennai
      </h3>
      <div class="flight-list">
        {outboundFlights.map((flight: FlightSegment) => (
          <FlightCard flight={flight} />
        ))}
      </div>
    </div>

    <!-- Return Flights -->
    <div class="flight-group">
      <h3 class="flight-group-title">
        <span class="group-icon return">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="19" y1="12" x2="5" y2="12"></line>
            <polyline points="12 19 5 12 12 5"></polyline>
          </svg>
        </span>
        Return: Chennai to Dallas
      </h3>
      <div class="flight-list">
        {returnFlights.map((flight: FlightSegment) => (
          <FlightCard flight={flight} />
        ))}
      </div>
    </div>
  </section>

  <!-- Visa Section -->
  <section class="section">
    <div class="section-header">
      <h2 class="section-title">
        <span class="section-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10 9 9 9 8 9"></polyline>
          </svg>
        </span>
        Visa
      </h2>
      <Badge variant="granted" size="md">{visa.status}</Badge>
    </div>

    <Card>
      <div class="visa-content">
        <div class="visa-header">
          <h3 class="visa-type">{visa.type}</h3>
          <p class="visa-traveler">For: {traveler.name}</p>
        </div>

        <div class="visa-details">
          <div class="visa-detail">
            <span class="detail-label">ETA Number</span>
            <span class="detail-value eta-number">{visa.etaNumber}</span>
          </div>
          <div class="visa-detail">
            <span class="detail-label">Application ID</span>
            <span class="detail-value">{visa.applicationId}</span>
          </div>
          <div class="visa-detail">
            <span class="detail-label">Valid From</span>
            <span class="detail-value">{formatDate(visa.issueDate)}</span>
          </div>
          <div class="visa-detail">
            <span class="detail-label">Valid Until</span>
            <span class="detail-value">{formatDate(visa.expiryDate)}</span>
          </div>
          <div class="visa-detail">
            <span class="detail-label">Entries</span>
            <span class="detail-value">{visa.entries}</span>
          </div>
          <div class="visa-detail">
            <span class="detail-label">Maximum Stay</span>
            <span class="detail-value">{visa.maxStay}</span>
          </div>
        </div>

        {visa.notes && visa.notes.length > 0 && (
          <div class="visa-notes">
            <h4 class="notes-title">Important Notes</h4>
            <ul class="notes-list">
              {visa.notes.map((note: string) => (
                <li class="note-item">{note}</li>
              ))}
            </ul>
          </div>
        )}
      </div>
    </Card>
  </section>

  <!-- Accommodation Section -->
  <section class="section">
    <div class="section-header">
      <h2 class="section-title">
        <span class="section-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
          </svg>
        </span>
        Accommodation
      </h2>
      <Badge variant={getAccommodationStatusVariant(hotel.status)} size="md">
        {getAccommodationStatusText(hotel.status)}
      </Badge>
    </div>

    <Card>
      <div class="accommodation-content">
        <div class="accommodation-header">
          <h3 class="hotel-name">{hotel.name}</h3>
          <p class="hotel-location">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            {hotel.area}, {hotel.city}
          </p>
        </div>

        {hotel.notes && (
          <div class="accommodation-notes">
            <p class="hotel-notes">{hotel.notes}</p>
          </div>
        )}

        {hotel.contact?.website && (
          <div class="accommodation-actions">
            <a href={hotel.contact.website} target="_blank" rel="noopener noreferrer" class="hotel-link">
              View Hotel Website
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
              </svg>
            </a>
          </div>
        )}

        {hotel.status === "considering" && (
          <div class="status-notice">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <span>This accommodation is under consideration and has not been booked yet.</span>
          </div>
        )}
      </div>
    </Card>
  </section>
</BaseLayout>

<style>
  /* Page Header */
  .page-header {
    margin-bottom: var(--spacing-8);
  }

  .page-title {
    font-size: var(--font-size-4xl);
    margin-bottom: var(--spacing-2);
  }

  .page-description {
    font-size: var(--font-size-lg);
    color: var(--color-text-secondary);
  }

  /* Sections */
  .section {
    margin-bottom: var(--spacing-10);
  }

  .section-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-4);
    margin-bottom: var(--spacing-6);
  }

  .section-title {
    font-size: var(--font-size-2xl);
    margin: 0;
    display: flex;
    align-items: center;
    gap: var(--spacing-3);
  }

  .section-icon {
    color: var(--color-gold-600);
  }

  /* Confirmation Card */
  .confirmation-card {
    background: linear-gradient(135deg, var(--color-gold-500) 0%, var(--color-orange-500) 100%);
    margin-bottom: var(--spacing-6);
  }

  .confirmation-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: white;
  }

  .confirmation-label {
    display: block;
    font-size: var(--font-size-sm);
    opacity: 0.9;
    margin-bottom: var(--spacing-1);
  }

  .confirmation-code {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    letter-spacing: 0.1em;
    font-family: monospace;
  }

  .airline-name {
    font-size: var(--font-size-xl);
    font-weight: var(--font-weight-semibold);
    opacity: 0.95;
  }

  /* Flight Groups */
  .flight-group {
    margin-bottom: var(--spacing-6);
  }

  .flight-group:last-child {
    margin-bottom: 0;
  }

  .flight-group-title {
    font-size: var(--font-size-lg);
    color: var(--color-earth-700);
    margin-bottom: var(--spacing-4);
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
  }

  .group-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: 50%;
  }

  .group-icon.outbound {
    background-color: var(--color-info-light);
    color: var(--color-info);
  }

  .group-icon.return {
    background-color: var(--color-orange-100);
    color: var(--color-orange-600);
  }

  .flight-list {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-4);
  }

  /* Visa Section */
  .visa-content {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-6);
  }

  .visa-header {
    border-bottom: 1px solid var(--color-border-light);
    padding-bottom: var(--spacing-4);
  }

  .visa-type {
    font-size: var(--font-size-xl);
    margin: 0 0 var(--spacing-1) 0;
    color: var(--color-earth-900);
  }

  .visa-traveler {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    margin: 0;
  }

  .visa-details {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--spacing-4);
  }

  .visa-detail {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-1);
  }

  .detail-label {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .detail-value {
    font-size: var(--font-size-base);
    color: var(--color-earth-900);
    font-weight: var(--font-weight-medium);
  }

  .eta-number {
    font-size: var(--font-size-lg);
    font-family: monospace;
    letter-spacing: 0.05em;
    color: var(--color-gold-700);
  }

  .visa-notes {
    background-color: var(--color-cream-100);
    padding: var(--spacing-4);
    border-radius: var(--radius-card);
    border-left: 3px solid var(--color-gold-400);
  }

  .notes-title {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-semibold);
    color: var(--color-earth-700);
    margin: 0 0 var(--spacing-2) 0;
  }

  .notes-list {
    margin: 0;
    padding-left: var(--spacing-4);
  }

  .note-item {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-1);
  }

  .note-item:last-child {
    margin-bottom: 0;
  }

  /* Accommodation Section */
  .accommodation-content {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-4);
  }

  .hotel-name {
    font-size: var(--font-size-xl);
    margin: 0 0 var(--spacing-2) 0;
    color: var(--color-earth-900);
  }

  .hotel-location {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    margin: 0;
  }

  .hotel-location svg {
    color: var(--color-earth-400);
  }

  .hotel-notes {
    font-size: var(--font-size-base);
    color: var(--color-text-secondary);
    margin: 0;
    padding: var(--spacing-3);
    background-color: var(--color-cream-100);
    border-radius: var(--radius-button);
  }

  .hotel-link {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-2);
    color: var(--color-gold-700);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .hotel-link:hover {
    color: var(--color-gold-500);
    text-decoration: underline;
  }

  .status-notice {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-2);
    padding: var(--spacing-3);
    background-color: var(--color-warning-light);
    border-radius: var(--radius-button);
    font-size: var(--font-size-sm);
    color: var(--color-orange-800);
  }

  .status-notice svg {
    flex-shrink: 0;
    margin-top: 2px;
  }

  /* Responsive */
  @media (max-width: 767px) {
    .confirmation-content {
      flex-direction: column;
      gap: var(--spacing-3);
      text-align: center;
    }

    .confirmation-code {
      font-size: var(--font-size-2xl);
    }

    .visa-details {
      grid-template-columns: repeat(2, 1fr);
    }

    .section-header {
      flex-direction: column;
      align-items: flex-start;
      gap: var(--spacing-2);
    }
  }

  @media (max-width: 480px) {
    .visa-details {
      grid-template-columns: 1fr;
    }
  }
</style>
