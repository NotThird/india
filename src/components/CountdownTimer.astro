---
/**
 * CountdownTimer Component
 * Live countdown to departure
 */
interface Props {
  targetDate: string;
  label?: string;
}

const { targetDate, label = "Until Departure" } = Astro.props;
---

<div class="countdown" data-target={targetDate}>
  <div class="countdown-label">{label}</div>
  <div class="countdown-grid">
    <div class="countdown-item">
      <span class="countdown-value" data-days>--</span>
      <span class="countdown-unit">days</span>
    </div>
    <div class="countdown-item">
      <span class="countdown-value" data-hours>--</span>
      <span class="countdown-unit">hrs</span>
    </div>
    <div class="countdown-item">
      <span class="countdown-value" data-minutes>--</span>
      <span class="countdown-unit">min</span>
    </div>
    <div class="countdown-item">
      <span class="countdown-value" data-seconds>--</span>
      <span class="countdown-unit">sec</span>
    </div>
  </div>
</div>

<script>
  function initCountdown() {
    const countdowns = document.querySelectorAll('.countdown');

    countdowns.forEach(countdown => {
      const target = new Date(countdown.getAttribute('data-target') + 'T11:30:00').getTime();

      function update() {
        const now = new Date().getTime();
        const diff = target - now;

        if (diff <= 0) {
          countdown.querySelector('[data-days]')!.textContent = '0';
          countdown.querySelector('[data-hours]')!.textContent = '0';
          countdown.querySelector('[data-minutes]')!.textContent = '0';
          countdown.querySelector('[data-seconds]')!.textContent = '0';
          return;
        }

        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

        countdown.querySelector('[data-days]')!.textContent = String(days);
        countdown.querySelector('[data-hours]')!.textContent = String(hours).padStart(2, '0');
        countdown.querySelector('[data-minutes]')!.textContent = String(minutes).padStart(2, '0');
        countdown.querySelector('[data-seconds]')!.textContent = String(seconds).padStart(2, '0');
      }

      update();
      setInterval(update, 1000);
    });
  }

  initCountdown();
</script>

<style>
  .countdown {
    text-align: center;
  }

  .countdown-label {
    font-size: var(--font-size-sm);
    color: rgba(255, 255, 255, 0.8);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: var(--spacing-3);
  }

  .countdown-grid {
    display: flex;
    justify-content: center;
    gap: var(--spacing-4);
  }

  .countdown-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 50px;
  }

  .countdown-value {
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    color: white;
    line-height: 1;
    font-variant-numeric: tabular-nums;
  }

  .countdown-unit {
    font-size: var(--font-size-xs);
    color: rgba(255, 255, 255, 0.7);
    text-transform: uppercase;
    margin-top: var(--spacing-1);
  }

  @media (max-width: 600px) {
    .countdown-grid {
      gap: var(--spacing-2);
    }

    .countdown-item {
      min-width: 40px;
    }

    .countdown-value {
      font-size: var(--font-size-2xl);
    }

    .countdown-unit {
      font-size: 10px;
    }
  }
</style>
